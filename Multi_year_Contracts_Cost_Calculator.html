<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Odoo Multi-Years Contract Pricing Comparison</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-text: #1f2937;
            --secondary-text: #6b7280;
            --light-bg: #f9fafb;
            --card-bg: rgba(255, 255, 255, 0.85);
            --border-color: #e5e7eb;
            --apple-blue: #007aff;
            --apple-purple: #9b51e0;
            --apple-pink: #ec4899;
            --apple-gradient: linear-gradient(135deg, #007aff, #9b51e0);
            --odoo-purple: #714B67; /* Odoo dark color for emphasis */
            --odoo-light: #F7F4F9; /* Odoo light background for tables */
            --ios-gray-border: #e8e8ed;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f0f4ff 0%, #e0e7ff 40%, #fdf2f8 100%);
            color: var(--primary-text);
            min-height: 100vh;
        }

        .main-container {
            background: var(--card-bg);
            backdrop-filter: blur(24px);
            border-radius: 1.5rem;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.6);
        }

        /* Navigation Button Styles */
        .nav-btn {
            padding: 0.5rem 1rem;
            margin: 0 0.5rem;
            border-radius: 9999px;
            font-weight: 500;
            color: var(--primary-text);
            text-decoration: none;
            transition: all 0.2s ease-in-out;
            background: transparent;
        }

        .nav-btn:hover {
            background: rgba(0, 0, 0, 0.05);
            color: var(--primary-text);
        }

        .nav-btn.active {
            color: white;
            /* UPDATED: Changed from --odoo-purple to --apple-gradient to match duration buttons */
            background: var(--apple-gradient); 
            box-shadow: 0 4px 10px rgba(0, 122, 255, 0.4); /* Adjusted shadow for gradient */
            font-weight: 600;
        }

        .tab-toggle-group {
            background: rgba(255, 255, 255, 0.7);
            border: 1px solid rgba(0, 0, 0, 0.05);
            border-radius: 9999px;
            padding: 0.4rem;
            display: inline-flex;
            gap: 0.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .tab-toggle-btn {
            padding: 0.75rem 1.8rem;
            border-radius: 9999px;
            font-weight: 600;
            color: var(--secondary-text);
            transition: all 0.3s ease;
        }

        .tab-toggle-btn.active {
            color: white; 
            background: var(--apple-gradient);
            box-shadow: 0 4px 12px rgba(0, 122, 255, 0.4);
        }

        .contract-btn {
            padding: 0.75rem 2rem;
            border-radius: 9999px;
            font-weight: 600;
            color: var(--primary-text);
            background: var(--light-bg);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .contract-btn.active {
            color: white;
            background: var(--apple-gradient);
            box-shadow: 0 6px 18px rgba(0, 122, 255, 0.4);
            transform: translateY(-2px);
        }
        
        .number-input {
            padding: 0.75rem 0.5rem; 
            border-radius: 9999px; 
            font-weight: 600;
            color: var(--primary-text);
            background: var(--light-bg);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            text-align: center;
            -moz-appearance: textfield;
        }
        .number-input::-webkit-outer-spin-button,
        .number-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .highlight {
            background: var(--apple-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Tooltip/Info Icon Styles */
        .info-icon {
            background: var(--apple-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: inline-block;
            cursor: pointer;
            vertical-align: middle;
            margin-left: 0.25rem;
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            opacity: 0;
            width: 280px; 
            background-color: var(--primary-text);
            color: #fff;
            text-align: left;
            border-radius: 0.5rem;
            padding: 12px 15px;
            position: absolute;
            z-index: 100;
            bottom: 125%; 
            left: 50%;
            margin-left: -140px; 
            transition: opacity 0.3s, visibility 0.3s;
            font-size: 0.85rem;
            line-height: 1.4;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            font-weight: 400;
        }

        /* Show tooltip on hover */
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        /* Show tooltip when click-toggled (overrides hover rules for persistence) */
        .tooltip .tooltiptext.visible-on-click {
            visibility: visible !important;
            opacity: 1 !important;
        }

        /* Tooltip arrow */
        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: var(--primary-text) transparent transparent transparent;
        }


        .print-btn {
            position: fixed;
            top: 2rem;
            right: 2rem;
            padding: 10px 18px;
            border-radius: 9999px;
            background: linear-gradient(45deg, #00C9FF, #92FE9D);
            color: white;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border: none;
            cursor: pointer;
            z-index: 1000;
        }

        .print-report {
            display: none;
        }

        /* --- PRINT STYLES (PDF Reference Aesthetic) --- */
        @media print {
            body {
                background: white;
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
                width: 210mm; 
                height: 297mm;
                margin: 0;
                padding: 0;
                font-size: 9.5pt;
                font-family: 'Inter', sans-serif;
                color: #333;
            }
            .main-container, .print-btn, .tooltip, .info-icon, .page-nav { /* Added .page-nav */
                display: none !important;
            }
            .print-report {
                display: block;
                padding: 30px; 
                position: relative;
                box-sizing: border-box; 
                height: 297mm;
                overflow: hidden;
            }
            
            /* HEADER STYLES */
            .print-logo-container {
                position: absolute;
                top: 30px;
                right: 30px;
                width: 150px;
                height: 50px;
            }
            .print-logo-container img {
                height: 50px;
                width: auto;
                max-width: 100%; 
                max-height: 100%;
            }

            .print-header {
                display: flex;
                flex-direction: column;
                margin-bottom: 1.5rem;
            }
            
            .print-title {
                margin-bottom: 0.5rem;
            }

            .print-title h1 {
                font-size: 1.8rem;
                font-weight: 800;
                color: var(--odoo-purple);
                margin-bottom: 0;
            }
            .print-title p {
                font-size: 0.9rem;
                color: #666;
                font-weight: 600;
            }

            /* BODY SECTIONS */
            .print-body {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 25px;
            }

            .print-data-table {
                width: 100%;
                margin-bottom: 1.5rem;
                border: none;
            }
            
            .print-data-table h2 {
                font-size: 1.1rem;
                font-weight: 700;
                color: var(--primary-text);
                margin-bottom: 0.5rem;
                padding-bottom: 0.25rem;
                border-bottom: 1px solid var(--ios-gray-border);
            }
            
            .print-table {
                width: 100%;
                border-collapse: collapse;
            }

            .print-table tr {
                border-bottom: 1px solid #ddd;
            }
            .print-table tr:last-child {
                border-bottom: none;
            }

            .print-table td {
                padding: 5px 0;
                font-size: 9.5pt;
            }

            .print-table .label {
                text-align: left;
                font-weight: 400;
                color: #444;
                width: 70%;
            }

            .print-table .value {
                text-align: right;
                font-weight: 600;
                color: var(--primary-text);
                width: 30%;
            }

            .print-table .total-row td {
                font-weight: 700;
                background-color: var(--odoo-light);
                border-top: 1px solid #aaa;
                padding: 8px 0;
            }
            
            .print-table .savings-row .value {
                color: #10b981;
                font-size: 10.5pt;
                font-weight: 800;
            }

            /* FOOTER STYLES */
            .print-footer {
                position: absolute;
                bottom: 30px;
                left: 30px;
                right: 30px;
                padding-top: 10px;
                border-top: 1px solid #ddd;
            }
            .print-footer p {
                font-size: 8pt;
                color: #666;
                line-height: 1.4;
                margin-bottom: 5px;
            }
        }
    </style>
</head>
<body class="p-6 md:p-10">
    <!-- Print Button (Visible in Browser, Hidden in Print) -->
    <button id="print-btn" class="print-btn">Print Your Report</button>

    <!-- Navigation Bar (Added) -->
    <nav class="page-nav flex justify-center max-w-7xl mx-auto mb-10 pt-4 pb-2">
        <a href="index.html" class="nav-btn">Yearly vs Monthly Price</a>
        <a href="Multi_year_Contracts_Cost_Calculator.html" class="nav-btn active">Multi-Year Contracts</a>
        <a href="Implementation_Service_Cost_Calculator.html" class="nav-btn">Implementation Service</a>
    </nav>
    
    <!-- Main Calculator UI (Visible in Browser, Hidden in Print) -->
    <div class="max-w-7xl mx-auto p-8 main-container">
        <header class="text-center mb-12">
            <h1 class="text-4xl md:text-6xl font-bold section-header mb-3">Odoo Multi Year Contracts</h1>
            <p class="text-lg text-gray-600 max-w-2xl mx-auto">Compare <span class="font-semibold text-gray-800">multi-year Odoo contracts</span> and calculate <span class="highlight">savings in INR</span>.</p>
        </header>

        <div class="flex flex-col md:flex-row items-center justify-center mb-8 gap-6">
            <div class="flex-shrink-0">
                <p class="text-lg font-medium text-gray-700 mb-2 text-center md:text-left">Select a Plan:</p>
                <div class="tab-toggle-group">
                    <button id="standard-tab" class="tab-toggle-btn active">Standard</button>
                    <button id="custom-tab" class="tab-toggle-btn">Custom</button>
                </div>
            </div>
            <div class="w-full">
                <p class="text-lg font-medium text-gray-700 mb-2 text-center md:text-left">Number of Users:</p>
                <div class="flex items-center gap-4">
                    <!-- Adjusted max-w-lg for better responsiveness with the number input -->
                    <input type="range" id="users-input" min="1" max="100" value="10" class="w-full max-w-lg">
                    <input type="number" id="users-number-input" min="1" max="100" value="10" class="number-input w-20">
                </div>
            </div>
        </div>

        <div class="mb-10 text-center">
            <h2 class="text-2xl font-bold section-header mb-4">Choose Your Contract Duration</h2>
            <div class="flex justify-center flex-wrap gap-4">
                <button id="1year-btn" class="contract-btn active">1 Year</button>
                <button id="2year-btn" class="contract-btn">2 Years</button>
                <button id="3year-btn" class="contract-btn">3 Years</button>
                <button id="4year-btn" class="contract-btn">4 Years</button>
                <button id="5year-btn" class="contract-btn">5 Years</button>
            </div>
        </div>

        <div id="pricing-summary" class="p-8 rounded-2xl mb-8 card">
            <!-- Pricing Summary will be dynamically injected here -->
        </div>

        <div class="mt-12 text-center">
            <h2 class="text-2xl sm:text-3xl font-semibold section-header mb-6">Visual Comparison</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="card p-6">
                    <h3 class="text-xl font-semibold mb-4 text-gray-900">Total Price Comparison</h3>
                    <div class="chart-container p-4">
                        <canvas id="priceChart"></canvas>
                    </div>
                </div>
                <div class="card p-6">
                    <h3 class="text-xl font-semibold mb-4 text-gray-900">Savings Percentage</h3>
                    <div class="chart-container p-4">
                        <canvas id="savingsChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <div id="non-contract-section" class="mt-12 text-center">
            <h2 class="text-2xl sm:text-3xl font-semibold section-header mb-6">Non-Contract Pricing</h2>
            <div id="non-contract-summary" class="p-8 rounded-2xl mb-8 card text-center">
                 <!-- Non-contract summary will be dynamically injected here -->
            </div>
        </div>
    </div>
    
    <!-- Print Report Container (Hidden in Browser, Visible in Print) -->
    <div id="print-report-container"></div>
    
    <script>
        // Global function to toggle tooltip visibility on click
        const toggleTooltip = (event) => {
            event.stopPropagation();
            const tooltip = event.currentTarget;
            const tooltipText = tooltip.querySelector('.tooltiptext');

            if (!tooltipText) return;

            // Toggle a class for click persistence
            tooltipText.classList.toggle('visible-on-click');
        };

        // Global listener to hide all click-visible tooltips when clicking anywhere else
        document.addEventListener('click', (e) => {
            document.querySelectorAll('.tooltip .tooltiptext').forEach(tt => {
                // Hide if the click target is outside the currently visible tooltip
                if (tt.classList.contains('visible-on-click') && !e.target.closest('.tooltip')) {
                    tt.classList.remove('visible-on-click');
                }
            });
        });

        document.addEventListener('DOMContentLoaded', () => {
            const standardPlan = {
                basePrice: 8700,
                discounts: {
                    year1: 0.20,
                    year2: { year1: 0.20, years2: 0.05 },
                    year3: { year1: 0.20, years2_3: 0.10 },
                    year4: { year1: 0.20, years2_4: 0.125 },
                    year5: { year1: 0.20, years2_5: 0.15 }
                }
            };
            const customPlan = {
                basePrice: 13800,
                discounts: {
                    year1_amount: 3120,
                    year1_percent: (3120 / 13800) * 100,
                    year2: { year1_amount: 3120, years2: 0.05 },
                    year3: { year1_amount: 3120, years2_3: 0.10 },
                    year4: { year1_amount: 3120, years2_4: 0.125 },
                    year5: { year1_amount: 3120, years2_5: 0.15 }
                }
            };
            const GST_RATE = 0.18;

            const usersInput = document.getElementById('users-input');
            const usersNumberInput = document.getElementById('users-number-input');
            const standardTabBtn = document.getElementById('standard-tab');
            const customTabBtn = document.getElementById('custom-tab');
            const contractButtons = document.querySelectorAll('.contract-btn');
            const pricingSummaryDiv = document.getElementById('pricing-summary');
            const nonContractSummaryDiv = document.getElementById('non-contract-summary');
            const priceChartCanvas = document.getElementById('priceChart').getContext('2d');
            const savingsChartCanvas = document.getElementById('savingsChart').getContext('2d');
            const printBtn = document.getElementById('print-btn');
            const printReportContainer = document.getElementById('print-report-container');

            let currentPlan = 'standard';
            let currentContract = '1year';
            let priceChartInstance;
            let savingsChartInstance;

            const formatCurrency = (num) => num.toLocaleString('en-IN', { style: 'currency', currency: 'INR', minimumFractionDigits: 2, maximumFractionDigits: 2 });
            
            // Helper function to generate the Renewal Info Icon and Tooltip
            const getRenewalInfoHtml = (planType, years, users) => {
                const basePricePerUser = planType === 'standard' ? standardPlan.basePrice : customPlan.basePrice;
                const renewalYears = years - 1;
                let renewalDiscountRate;
                
                if (years === 2) {
                    renewalDiscountRate = planType === 'standard' ? standardPlan.discounts.year2.years2 : customPlan.discounts.year2.years2;
                } else {
                    // Correctly map multi-year discounts for 3, 4, and 5 years
                    const discountKey = `years2_${years > 2 ? years : ''}`;
                    renewalDiscountRate = planType === 'standard' 
                        ? standardPlan.discounts[`year${years}`][discountKey] 
                        : customPlan.discounts[`year${years}`][discountKey];
                }

                const totalRenewalBasePrice = basePricePerUser * users * renewalYears;
                const renewalDiscountAmount = totalRenewalBasePrice * renewalDiscountRate;
                const discountedRenewalPrice = totalRenewalBasePrice - renewalDiscountAmount;
                const renewalPeriod = renewalYears > 1 ? `Years 2-${years}` : `Year 2`;
                
                return `
                    <div class="inline-block relative tooltip cursor-pointer" onclick="toggleTooltip(event)">
                        <!-- Lightbulb SVG Icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="info-icon" viewBox="0 0 16 16">
                            <path d="M2 6a6 6 0 1 1 10.174 4.31c-.203.18-.352.421-.426.657M8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0m-.276 5.611c-.552-.167-.935-.615-.935-1.111 0-.547.41-.953.945-.992l.006-.001a1.05 1.05 0 0 1 .271 0c.552.167.935.615.935 1.111 0 .547-.41.953-.945.992l-.006.001a1.05 1.05 0 0 1-.271 0zM5.5 12h5A2.5 2.5 0 0 1 8 14.5a2.5 2.5 0 0 1-2.5-2.5z"/>
                            <path d="M4.174 10.31c-.702-.455-1.173-1.1-1.174-1.849 0-.986.732-1.765 1.637-2.025l.004-.001a2.05 2.05 0 0 1 .53-.082l.005.001c.905.26 1.637 1.039 1.637 2.025 0 .748-.472 1.393-1.174 1.849a2.05 2.05 0 0 1-.53.082M11.826 10.31c.702-.455 1.173-1.1 1.174-1.849 0-.986-.732-1.765-1.637-2.025l-.004-.001a2.05 2.05 0 0 1-.53-.082l-.005.001c-.905.26-1.637 1.039-1.637 2.025 0 .748.472 1.393 1.174 1.849a2.05 2.05 0 0 1 .53.082z"/>
                        </svg>
                        <span class="tooltiptext">
                            <strong>Renewal Period Cost Breakdown:</strong><br>
                            This calculation applies to the discounted price for the **${renewalPeriod}** renewal years.<br>
                            <br>
                            Base Price for Renewal Period: ${formatCurrency(totalRenewalBasePrice)}<br>
                            Discount Applied (${(renewalDiscountRate * 100).toFixed(2)}%): -${formatCurrency(renewalDiscountAmount)}<br>
                            <hr style="margin: 4px 0;">
                            Discounted Price (Excl. GST): ${formatCurrency(discountedRenewalPrice)}
                        </span>
                    </div>
                `;
            };

            const calculateStandard = (users) => {
                const basePrice = standardPlan.basePrice * users;
                const year1Discounted = basePrice * (1 - standardPlan.discounts.year1);
                
                const year2_discounted = basePrice * (1 - standardPlan.discounts.year2.years2);
                const year2_3_discounted = basePrice * (1 - standardPlan.discounts.year3.years2_3);
                const year2_4_discounted = basePrice * (1 - standardPlan.discounts.year4.years2_4);
                const year2_5_discounted = basePrice * (1 - standardPlan.discounts.year5.years2_5);

                const price1Y = year1Discounted;
                const price2Y = year1Discounted + year2_discounted;
                const price3Y = year1Discounted + (year2_3_discounted * 2);
                const price4Y = year1Discounted + (year2_4_discounted * 3);
                const price5Y = year1Discounted + (year2_5_discounted * 4);
                
                const price1Y_final = price1Y * (1 + GST_RATE);
                const price2Y_final = price2Y * (1 + GST_RATE);
                const price3Y_final = price3Y * (1 + GST_RATE);
                const price4Y_final = price4Y * (1 + GST_RATE);
                const price5Y_final = price5Y * (1 + GST_RATE);
                
                const nonContract2Y = year1Discounted + (basePrice * 1);
                const nonContract3Y = year1Discounted + (basePrice * 2);
                const nonContract4Y = year1Discounted + (basePrice * 3);
                const nonContract5Y = year1Discounted + (basePrice * 4);
                
                const nonContract2Y_final = nonContract2Y * (1 + GST_RATE);
                const nonContract3Y_final = nonContract3Y * (1 + GST_RATE);
                const nonContract4Y_final = nonContract4Y * (1 + GST_RATE);
                const nonContract5Y_final = nonContract5Y * (1 + GST_RATE);
                
                const savings2Y = nonContract2Y_final - price2Y_final;
                const savings3Y = nonContract3Y_final - price3Y_final;
                const savings4Y = nonContract4Y_final - price4Y_final;
                const savings5Y = nonContract5Y_final - price5Y_final;

                const savingsPercent2Y = (savings2Y / nonContract2Y_final) * 100;
                const savingsPercent3Y = (savings3Y / nonContract3Y_final) * 100;
                const savingsPercent4Y = (savings4Y / nonContract4Y_final) * 100;
                const savingsPercent5Y = (savings5Y / nonContract5Y_final) * 100;

                return {
                    basePrice, year1Discounted,
                    year2_discounted, year2_3_discounted, year2_4_discounted, year2_5_discounted,
                    price1Y, price2Y, price3Y, price4Y, price5Y,
                    price1Y_final, price2Y_final, price3Y_final, price4Y_final, price5Y_final,
                    savings2Y, savings3Y, savings4Y, savings5Y,
                    savingsPercent2Y, savingsPercent3Y, savingsPercent4Y, savingsPercent5Y,
                    nonContract2Y_final, nonContract3Y_final, nonContract4Y_final, nonContract5Y_final
                };
            };

            const calculateCustom = (users) => {
                const basePrice = customPlan.basePrice * users;
                const year1DiscountAmount = customPlan.discounts.year1_amount * users;
                const year1Discounted = basePrice - year1DiscountAmount;
                
                const year2_discounted = basePrice * (1 - customPlan.discounts.year2.years2);
                const year2_3_discounted = basePrice * (1 - customPlan.discounts.year3.years2_3);
                const year2_4_discounted = basePrice * (1 - customPlan.discounts.year4.years2_4);
                const year2_5_discounted = basePrice * (1 - customPlan.discounts.year5.years2_5);
                
                const price1Y = year1Discounted;
                const price2Y = year1Discounted + year2_discounted;
                const price3Y = year1Discounted + (year2_3_discounted * 2);
                const price4Y = year1Discounted + (year2_4_discounted * 3);
                const price5Y = year1Discounted + (year2_5_discounted * 4);

                const price1Y_final = price1Y * (1 + GST_RATE);
                const price2Y_final = price2Y * (1 + GST_RATE);
                const price3Y_final = price3Y * (1 + GST_RATE);
                const price4Y_final = price4Y * (1 + GST_RATE);
                const price5Y_final = price5Y * (1 + GST_RATE);
                
                const nonContract2Y = year1Discounted + (basePrice * 1);
                const nonContract3Y = year1Discounted + (basePrice * 2);
                const nonContract4Y = year1Discounted + (basePrice * 3);
                const nonContract5Y = year1Discounted + (basePrice * 4);

                const nonContract2Y_final = nonContract2Y * (1 + GST_RATE);
                const nonContract3Y_final = nonContract3Y * (1 + GST_RATE);
                const nonContract4Y_final = nonContract4Y * (1 + GST_RATE);
                const nonContract5Y_final = nonContract5Y * (1 + GST_RATE);
                
                const savings2Y = nonContract2Y_final - price2Y_final;
                const savings3Y = nonContract3Y_final - price3Y_final;
                const savings4Y = nonContract4Y_final - price4Y_final;
                const savings5Y = nonContract5Y_final - price5Y_final;
                
                const savingsPercent2Y = (savings2Y / nonContract2Y_final) * 100;
                const savingsPercent3Y = (savings3Y / nonContract3Y_final) * 100;
                const savingsPercent4Y = (savings4Y / nonContract4Y_final) * 100;
                const savingsPercent5Y = (savings5Y / nonContract5Y_final) * 100;

                return {
                    basePrice, year1Discounted, year1DiscountAmount,
                    year2_discounted, year2_3_discounted, year2_4_discounted, year2_5_discounted,
                    price1Y, price2Y, price3Y, price4Y, price5Y,
                    price1Y_final, price2Y_final, price3Y_final, price4Y_final, price5Y_final,
                    savings2Y, savings3Y, savings4Y, savings5Y,
                    savingsPercent2Y, savingsPercent3Y, savingsPercent4Y, savingsPercent5Y,
                    nonContract2Y_final, nonContract3Y_final, nonContract4Y_final, nonContract5Y_final
                };
            };

            const renderPricingSummary = (planType, contractDuration, users) => {
                const data = planType === 'standard' ? calculateStandard(users) : calculateCustom(users);
                const basePricePerUser = planType === 'standard' ? standardPlan.basePrice : customPlan.basePrice;
                const years = parseInt(contractDuration.replace('year', ''));
                const basePriceTotal = basePricePerUser * users * years;
                
                let contentHtml = '';

                // HTML for the initial Base Price info icon and tooltip
                const basePriceInfoHtml = `
                    <div class="inline-block relative tooltip cursor-pointer" onclick="toggleTooltip(event)">
                        <!-- Lightbulb SVG Icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="info-icon" viewBox="0 0 16 16">
                            <path d="M2 6a6 6 0 1 1 10.174 4.31c-.203.18-.352.421-.426.657M8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0m-.276 5.611c-.552-.167-.935-.615-.935-1.111 0-.547.41-.953.945-.992l.006-.001a1.05 1.05 0 0 1 .271 0c.552.167.935.615.935 1.111 0 .547-.41.953-.945.992l-.006.001a1.05 1.05 0 0 1-.271 0zM5.5 12h5A2.5 2.5 0 0 1 8 14.5a2.5 2.5 0 0 1-2.5-2.5z"/>
                            <path d="M4.174 10.31c-.702-.455-1.173-1.1-1.174-1.849 0-.986.732-1.765 1.637-2.025l.004-.001a2.05 2.05 0 0 1 .53-.082l.005.001c.905.26 1.637 1.039 1.637 2.025 0 .748-.472 1.393-1.174 1.849a2.05 2.05 0 0 1-.53.082M11.826 10.31c.702-.455 1.173-1.1 1.174-1.849 0-.986-.732-1.765-1.637-2.025l-.004-.001a2.05 2.05 0 0 1-.53-.082l-.005.001c-.905.26-1.637 1.039-1.637 2.025 0 .748.472 1.393 1.174 1.849a2.05 2.05 0 0 1 .53.082z"/>
                        </svg>
                        <span class="tooltiptext">
                            <strong>Base Annual Cost Calculation:</strong><br>
                            This value represents the total gross cost for the full contract duration before any discounts or taxes are applied.<br>
                            <br>
                            Calculation:<br>
                            ${users} users &times; ${formatCurrency(basePricePerUser)} (Cost per User/Year) &times; ${years} years<br>
                            = ${formatCurrency(basePriceTotal)}
                        </span>
                    </div>
                `;
                
                // Determine the renewal info HTML only for multi-year contracts
                const renewalInfoHtml = years > 1 ? getRenewalInfoHtml(planType, years, users) : '';


                if (contractDuration === '1year') {
                    contentHtml = `
                        <div class="text-center">
                            <h3 class="text-xl sm:text-2xl font-semibold text-gray-900 mb-2">1-Year Plan Price</h3>
                            <p class="text-4xl sm:text-5xl font-bold highlight mb-4">${formatCurrency(data.price1Y_final)}</p>
                            <p class="text-base sm:text-lg text-gray-600 mb-6">Price for ${users} users, including GST.</p>
                            <div class="mt-4 p-4 card rounded-xl text-left">
                                <h4 class="text-lg font-semibold text-gray-900 mb-2">Breakdown</h4>
                                <ul class="text-sm text-gray-600 space-y-1">
                                    <li>Base Price for ${users} users (${years} year contract): ${formatCurrency(basePriceTotal)} ${basePriceInfoHtml}</li>
                                    <li>Year 1 (${planType === 'standard' ? `${(standardPlan.discounts.year1 * 100).toFixed(0)}%` : `${customPlan.discounts.year1_percent.toFixed(2)}%`} discount): <span class="font-bold text-gray-800">${formatCurrency(data.price1Y)}</span></li>
                                    <li class="border-t border-gray-300 pt-2 mt-2">Subtotal (Excl. GST): <span class="font-bold text-gray-800">${formatCurrency(data.price1Y)}</span></li>
                                    <li>+ 18% GST: <span class="font-bold text-gray-800">${formatCurrency(data.price1Y_final - data.price1Y)}</span></li>
                                </ul>
                            </div>
                        </div>
                    `;
                } else if (contractDuration === '2year') {
                    const renewalDiscountDisplay = planType === 'standard' ? `Year 2 (${(standardPlan.discounts.year2.years2 * 100).toFixed(2)}% discount)` : `Year 2 (${(customPlan.discounts.year2.years2 * 100).toFixed(2)}% discount)`;
                    
                    const breakdownText = planType === 'standard' ? `
                        <li>Year 1 (${(standardPlan.discounts.year2.year1 * 100).toFixed(0)}% discount): <span class="font-bold text-gray-800">${formatCurrency(data.year1Discounted)}</span></li>
                        <li>${renewalDiscountDisplay}: <span class="font-bold text-gray-800">${formatCurrency(data.year2_discounted)}</span> ${renewalInfoHtml}</li>
                    ` : `
                        <li>Year 1 (${customPlan.discounts.year1_percent.toFixed(2)}% discount): <span class="font-bold text-gray-800">${formatCurrency(data.year1Discounted)}</span></li>
                        <li>${renewalDiscountDisplay}: <span class="font-bold text-gray-800">${formatCurrency(data.year2_discounted)}</span> ${renewalInfoHtml}</li>
                    `;
                    const avgYearlyCost = data.price2Y_final / 2;
                    
                    contentHtml = `
                        <div class="text-center">
                            <h3 class="text-xl sm:text-2xl font-semibold text-gray-900 mb-2">2-Year Plan Price</h3>
                            <p class="text-4xl sm:text-5xl font-bold highlight mb-4">${formatCurrency(data.price2Y_final)}</p>
                            <p class="text-base sm:text-lg text-gray-600 mb-6">Total price for ${users} users, including GST.</p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4 text-left">
                                <div class="p-4 card rounded-xl">
                                    <h4 class="text-lg font-semibold text-gray-900 mb-2">Breakdown</h4>
                                    <ul class="text-sm text-gray-600 space-y-1">
                                        <li>Base Price for ${users} users (${years} year contract): ${formatCurrency(basePriceTotal)} ${basePriceInfoHtml}</li>
                                        ${breakdownText}
                                        <li class="border-t border-gray-300 pt-2 mt-2">Subtotal (Excl. GST): <span class="font-bold text-gray-800">${formatCurrency(data.price2Y)}</span></li>
                                        <li>+ 18% GST: <span class="font-bold text-gray-800">${formatCurrency(data.price2Y_final - data.price2Y)}</span></li>
                                        <li class="border-t border-gray-300 pt-2 mt-2 font-semibold text-gray-800">Total Price (Inc. GST): <span class="font-bold text-gray-800">${formatCurrency(data.price2Y_final)}</span></li>
                                        <li class="font-semibold text-gray-800">Average Yearly Cost (Inc. GST): <span class="font-bold text-green-600">${formatCurrency(avgYearlyCost)}</span></li>
                                    </ul>
                                </div>
                                <div class="p-4 card rounded-xl">
                                    <h4 class="text-lg font-semibold text-gray-900 mb-2">Savings</h4>
                                    <ul class="text-sm text-gray-600 space-y-1">
                                        <li>Total Savings: <span class="font-bold text-green-600">${formatCurrency(data.savings2Y)}</span></li>
                                        <li>Savings Rate: <span class="font-bold text-green-600">${data.savingsPercent2Y.toFixed(2)}%</span></li>
                                        <li class="mt-2 text-xs text-gray-500">vs. non-contract price for 2 years.</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    `;
                } else if (contractDuration === '3year') {
                     const renewalDiscountDisplay = planType === 'standard' ? `Years 2-3 (${(standardPlan.discounts.year3.years2_3 * 100).toFixed(0)}% discount)` : `Years 2-3 (${(customPlan.discounts.year3.years2_3 * 100).toFixed(0)}% discount)`;

                    const breakdownText = planType === 'standard' ? `
                        <li>Year 1 (${(standardPlan.discounts.year3.year1 * 100).toFixed(0)}% discount): <span class="font-bold text-gray-800">${formatCurrency(data.year1Discounted)}</span></li>
                        <li>${renewalDiscountDisplay}: <span class="font-bold text-gray-800">${formatCurrency(data.year2_3_discounted * 2)}</span> ${renewalInfoHtml}</li>
                    ` : `
                        <li>Year 1 (${customPlan.discounts.year1_percent.toFixed(2)}% discount): <span class="font-bold text-gray-800">${formatCurrency(data.year1Discounted)}</span></li>
                        <li>${renewalDiscountDisplay}: <span class="font-bold text-gray-800">${formatCurrency(data.year2_3_discounted * 2)}</span> ${renewalInfoHtml}</li>
                    `;
                    const avgYearlyCost = data.price3Y_final / 3;
                    
                    contentHtml = `
                        <div class="text-center">
                            <h3 class="text-xl sm:text-2xl font-semibold text-gray-900 mb-2">3-Year Plan Price</h3>
                            <p class="text-4xl sm:text-5xl font-bold highlight mb-4">${formatCurrency(data.price3Y_final)}</p>
                            <p class="text-base sm:text-lg text-gray-600 mb-6">Total price for ${users} users, including GST.</p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4 text-left">
                                <div class="p-4 card rounded-xl">
                                    <h4 class="text-lg font-semibold text-gray-900 mb-2">Breakdown</h4>
                                    <ul class="text-sm text-gray-600 space-y-1">
                                        <li>Base Price for ${users} users (${years} year contract): ${formatCurrency(basePriceTotal)} ${basePriceInfoHtml}</li>
                                        ${breakdownText}
                                        <li class="border-t border-gray-300 pt-2 mt-2">Subtotal (Excl. GST): <span class="font-bold text-gray-800">${formatCurrency(data.price3Y)}</span></li>
                                        <li>+ 18% GST: <span class="font-bold text-gray-800">${formatCurrency(data.price3Y_final - data.price3Y)}</span></li>
                                        <li class="border-t border-gray-300 pt-2 mt-2 font-semibold text-gray-800">Total Price (Inc. GST): <span class="font-bold text-gray-800">${formatCurrency(data.price3Y_final)}</span></li>
                                        <li class="font-semibold text-gray-800">Average Yearly Cost (Inc. GST): <span class="font-bold text-green-600">${formatCurrency(avgYearlyCost)}</span></li>
                                    </ul>
                                </div>
                                <div class="p-4 card rounded-xl">
                                    <h4 class="text-lg font-semibold text-gray-900 mb-2">Savings</h4>
                                    <ul class="text-sm text-gray-600 space-y-1">
                                        <li>Total Savings: <span class="font-bold text-green-600">${formatCurrency(data.savings3Y)}</span></li>
                                        <li>Savings Rate: <span class="font-bold text-green-600">${data.savingsPercent3Y.toFixed(2)}%</span></li>
                                        <li class="mt-2 text-xs text-gray-500">vs. non-contract price for 3 years.</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    `;
                } else if (contractDuration === '4year') {
                    const renewalDiscountDisplay = planType === 'standard' ? `Years 2-4 (${(standardPlan.discounts.year4.years2_4 * 100).toFixed(2)}% discount)` : `Years 2-4 (${(customPlan.discounts.year4.years2_4 * 100).toFixed(2)}% discount)`;

                    const breakdownText = planType === 'standard' ? `
                        <li>Year 1 (${(standardPlan.discounts.year4.year1 * 100).toFixed(0)}% discount): <span class="font-bold text-gray-800">${formatCurrency(data.year1Discounted)}</span></li>
                        <li>${renewalDiscountDisplay}: <span class="font-bold text-gray-800">${formatCurrency(data.year2_4_discounted * 3)}</span> ${renewalInfoHtml}</li>
                    ` : `
                        <li>Year 1 (${customPlan.discounts.year1_percent.toFixed(2)}% discount): <span class="font-bold text-gray-800">${formatCurrency(data.year1Discounted)}</span></li>
                        <li>${renewalDiscountDisplay}: <span class="font-bold text-gray-800">${formatCurrency(data.year2_4_discounted * 3)}</span> ${renewalInfoHtml}</li>
                    `;
                    const avgYearlyCost = data.price4Y_final / 4;
                    
                    contentHtml = `
                        <div class="text-center">
                            <h3 class="text-xl sm:text-2xl font-semibold text-gray-900 mb-2">4-Year Plan Price</h3>
                            <p class="text-4xl sm:text-5xl font-bold highlight mb-4">${formatCurrency(data.price4Y_final)}</p>
                            <p class="text-base sm:text-lg text-gray-600 mb-6">Total price for ${users} users, including GST.</p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4 text-left">
                                <div class="p-4 card rounded-xl">
                                    <h4 class="text-lg font-semibold text-gray-900 mb-2">Breakdown</h4>
                                    <ul class="text-sm text-gray-600 space-y-1">
                                        <li>Base Price for ${users} users (${years} year contract): ${formatCurrency(basePriceTotal)} ${basePriceInfoHtml}</li>
                                        ${breakdownText}
                                        <li class="border-t border-gray-300 pt-2 mt-2">Subtotal (Excl. GST): <span class="font-bold text-gray-800">${formatCurrency(data.price4Y)}</span></li>
                                        <li>+ 18% GST: <span class="font-bold text-gray-800">${formatCurrency(data.price4Y_final - data.price4Y)}</span></li>
                                        <li class="border-t border-gray-300 pt-2 mt-2 font-semibold text-gray-800">Total Price (Inc. GST): <span class="font-bold text-gray-800">${formatCurrency(data.price4Y_final)}</span></li>
                                        <li class="font-semibold text-gray-800">Average Yearly Cost (Inc. GST): <span class="font-bold text-green-600">${formatCurrency(avgYearlyCost)}</span></li>
                                    </ul>
                                </div>
                                <div class="p-4 card rounded-xl">
                                    <h4 class="text-lg font-semibold text-gray-900 mb-2">Savings</h4>
                                    <ul class="text-sm text-gray-600 space-y-1">
                                        <li>Total Savings: <span class="font-bold text-green-600">${formatCurrency(data.savings4Y)}</span></li>
                                        <li>Savings Rate: <span class="font-bold text-green-600">${data.savingsPercent4Y.toFixed(2)}%</span></li>
                                        <li class="mt-2 text-xs text-gray-500">vs. non-contract price for 4 years.</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    `;
                } else if (contractDuration === '5year') {
                    const renewalDiscountDisplay = planType === 'standard' ? `Years 2-5 (${(standardPlan.discounts.year5.years2_5 * 100).toFixed(0)}% discount)` : `Years 2-5 (${(customPlan.discounts.year5.years2_5 * 100).toFixed(0)}% discount)`;

                    const breakdownText = planType === 'standard' ? `
                        <li>Year 1 (${(standardPlan.discounts.year5.year1 * 100).toFixed(0)}% discount): <span class="font-bold text-gray-800">${formatCurrency(data.year1Discounted)}</span></li>
                        <li>${renewalDiscountDisplay}: <span class="font-bold text-gray-800">${formatCurrency(data.year2_5_discounted * 4)}</span> ${renewalInfoHtml}</li>
                    ` : `
                        <li>Year 1 (${customPlan.discounts.year1_percent.toFixed(2)}% discount): <span class="font-bold text-gray-800">${formatCurrency(data.year1Discounted)}</span></li>
                        <li>${renewalDiscountDisplay}: <span class="font-bold text-gray-800">${formatCurrency(data.year2_5_discounted * 4)}</span> ${renewalInfoHtml}</li>
                    `;
                    const avgYearlyCost = data.price5Y_final / 5;
                    
                    contentHtml = `
                        <div class="text-center">
                            <h3 class="text-xl sm:text-2xl font-semibold text-gray-900 mb-2">5-Year Plan Price</h3>
                            <p class="text-4xl sm:text-5xl font-bold highlight mb-4">${formatCurrency(data.price5Y_final)}</p>
                            <p class="text-base sm:text-lg text-gray-600 mb-6">Total price for ${users} users, including GST.</p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4 text-left">
                                <div class="p-4 card rounded-xl">
                                    <h4 class="text-lg font-semibold text-gray-900 mb-2">Breakdown</h4>
                                    <ul class="text-sm text-gray-600 space-y-1">
                                        <li>Base Price for ${users} users (${years} year contract): ${formatCurrency(basePriceTotal)} ${basePriceInfoHtml}</li>
                                        ${breakdownText}
                                        <li class="border-t border-gray-300 pt-2 mt-2">Subtotal (Excl. GST): <span class="font-bold text-gray-800">${formatCurrency(data.price5Y)}</span></li>
                                        <li>+ 18% GST: <span class="font-bold text-gray-800">${formatCurrency(data.price5Y_final - data.price5Y)}</span></li>
                                        <li class="border-t border-gray-300 pt-2 mt-2 font-semibold text-gray-800">Total Price (Inc. GST): <span class="font-bold text-gray-800">${formatCurrency(data.price5Y_final)}</span></li>
                                        <li class="font-semibold text-gray-800">Average Yearly Cost (Inc. GST): <span class="font-bold text-green-600">${formatCurrency(avgYearlyCost)}</span></li>
                                    </ul>
                                </div>
                                <div class="p-4 card rounded-xl">
                                    <h4 class="text-lg font-semibold text-gray-900 mb-2">Savings</h4>
                                    <ul class="text-sm text-gray-600 space-y-1">
                                        <li>Total Savings: <span class="font-bold text-green-600">${formatCurrency(data.savings5Y)}</span></li>
                                        <li>Savings Rate: <span class="font-bold text-green-600">${data.savingsPercent5Y.toFixed(2)}%</span></li>
                                        <li class="mt-2 text-xs text-gray-500">vs. non-contract price for 5 years.</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    `;
                }
                pricingSummaryDiv.innerHTML = contentHtml;
            };
            
            const renderNonContractSummary = (planType, users) => {
                const data = planType === 'standard' ? calculateStandard(users) : calculateCustom(users);
                // Renamed 'basePrice' to 'basePricePerUser' to avoid confusion, though not used in calculations here
                const years = parseInt(currentContract.replace('year', ''));
                let nonContractPrice;
                if (currentContract === '1year') {
                    nonContractPrice = data.price1Y_final;
                } else if (currentContract === '2year') {
                    nonContractPrice = data.nonContract2Y_final;
                } else if (currentContract === '3year') {
                    nonContractPrice = data.nonContract3Y_final;
                } else if (currentContract === '4year') {
                    nonContractPrice = data.nonContract4Y_final;
                } else if (currentContract === '5year') {
                    nonContractPrice = data.nonContract5Y_final;
                }

                const nonContractExclGST = nonContractPrice / (1 + GST_RATE);
                const nonContractGST = nonContractPrice - nonContractExclGST;

                let contentHtml = `
                    <div class="grid grid-cols-1 md:grid-cols-1 gap-6">
                        <div class="p-4 card rounded-xl">
                            <h4 class="text-lg font-semibold text-gray-900 mb-2">${years}-Year Non-Contract Price</h4>
                            <p class="text-3xl font-bold highlight">${formatCurrency(nonContractPrice)}</p>
                            <ul class="text-sm text-gray-600 mt-2">
                                <li>Price (Excl. GST): <span class="font-bold">${formatCurrency(nonContractExclGST)}</span></li>
                                <li>+ 18% GST: <span class="font-bold">${formatCurrency(nonContractGST)}</span></li>
                                <li class="mt-2 text-xs text-gray-500">Includes Year 1 discount and regular price for remaining years.</li>
                            </ul>
                        </div>
                    </div>
                `;
                nonContractSummaryDiv.innerHTML = contentHtml;
            };

            const updateCharts = (planType, users) => {
                const data = planType === 'standard' ? calculateStandard(users) : calculateCustom(users);
                const currencyFormatter = (value) => formatCurrency(value);
                const savingsFormatter = (value) => `${value.toFixed(2)}%`;
                
                let totalLabels = ['Contract Price', 'Non-Contract Price'];
                let totalData = [];
                let totalColors = ['#9b51e0', '#d1d5db'];

                if (currentContract === '1year') {
                    totalData = [data.price1Y_final, data.price1Y_final];
                    totalColors = ['#007aff', '#d1d5db'];
                } else if (currentContract === '2year') {
                    totalData = [data.price2Y_final, data.nonContract2Y_final];
                    totalColors = ['#9b51e0', '#d1d5db'];
                } else if (currentContract === '3year') {
                    totalData = [data.price3Y_final, data.nonContract3Y_final];
                    totalColors = ['#ec4899', '#d1d5db'];
                } else if (currentContract === '4year') {
                    totalData = [data.price4Y_final, data.nonContract4Y_final];
                    totalColors = ['#4299e1', '#d1d5db'];
                } else if (currentContract === '5year') {
                    totalData = [data.price5Y_final, data.nonContract5Y_final];
                    totalColors = ['#d946ef', '#d1d5db'];
                }

                if (priceChartInstance) {
                    priceChartInstance.destroy();
                }
                priceChartInstance = new Chart(priceChartCanvas, {
                    type: 'bar',
                    data: {
                        labels: totalLabels,
                        datasets: [{
                            label: 'Total Price',
                            data: totalData,
                            backgroundColor: totalColors,
                            borderRadius: 12
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: { callbacks: { label: (context) => currencyFormatter(context.parsed.y) } }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: { color: '#e5e7eb' },
                                ticks: { color: 'var(--secondary-text)', callback: currencyFormatter }
                            },
                            x: {
                                grid: { display: false },
                                ticks: { color: 'var(--secondary-text)' }
                            }
                        }
                    }
                });

                const savingsData = [0, data.savingsPercent2Y, data.savingsPercent3Y, data.savingsPercent4Y, data.savingsPercent5Y];
                if (savingsChartInstance) {
                    savingsChartInstance.destroy();
                }
                savingsChartInstance = new Chart(savingsChartCanvas, {
                    type: 'bar',
                    data: {
                        labels: ['1 Year', '2 Years', '3 Years', '4 Years', '5 Years'],
                        datasets: [{
                            label: 'Savings Percentage',
                            data: savingsData,
                            backgroundColor: ['#d1d5db', '#007aff', '#9b51e0', '#4299e1', '#d946ef'],
                            borderRadius: 12
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: { callbacks: { label: (context) => savingsFormatter(context.parsed.y) } }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: { color: '#e5e7eb' },
                                ticks: { color: 'var(--secondary-text)', callback: savingsFormatter }
                            },
                            x: {
                                grid: { display: false },
                                ticks: { color: 'var(--secondary-text)' }
                            }
                        }
                    }
                });
            };

            const updateUI = () => {
                const users = parseInt(usersInput.value);
                renderPricingSummary(currentPlan, currentContract, users);
                renderNonContractSummary(currentPlan, users);
                updateCharts(currentPlan, users);
            };

            const getDurationName = (duration) => {
                const yearMap = {
                    '1year': '1-Year',
                    '2year': '2-Year',
                    '3year': '3-Year',
                    '4year': '4-Year',
                    '5year': '5-Year'
                };
                return yearMap[duration] || 'Multi-Year';
            };

            const generatePrintReport = (planType, contractDuration, users) => {
                const data = planType === 'standard' ? calculateStandard(users) : calculateCustom(users);
                const basePricePerUser = planType === 'standard' ? standardPlan.basePrice : customPlan.basePrice;
                const years = parseInt(contractDuration.replace('year', ''));
                const planName = planType.charAt(0).toUpperCase() + planType.slice(1);
                const durationName = getDurationName(contractDuration);

                // Calculations for the new print format
                const firstYearTaxable = data.year1Discounted;
                const firstYearGST = firstYearTaxable * GST_RATE;
                const firstYearTotal = firstYearTaxable + firstYearGST;
                const year1DiscountPercentage = planType === 'standard' ? (standardPlan.discounts.year1 * 100) : customPlan.discounts.year1_percent;
                const year1DiscountAmount = planType === 'standard' ? (basePricePerUser * users * standardPlan.discounts.year1) : (customPlan.discounts.year1_amount * users);

                let renewalSectionHtml = '';
                let renewalYears = years > 1 ? years - 1 : 0;

                // Generate renewal section for contracts longer than 1 year
                if (renewalYears > 0) {
                    const contractPriceUntaxed = data[`price${years}Y`];
                    const contractRenewalPriceUntaxed = contractPriceUntaxed - firstYearTaxable;
                    const contractRenewalPrice = contractRenewalPriceUntaxed * (1 + GST_RATE);
                    
                    let renewalDiscountRate;
                    if (years === 2) {
                        renewalDiscountRate = planType === 'standard' ? standardPlan.discounts.year2.years2 : customPlan.discounts.year2.years2;
                    } else {
                        const discountKey = `years2_${years > 2 ? years : ''}`;
                        renewalDiscountRate = planType === 'standard' 
                            ? standardPlan.discounts[`year${years}`][discountKey] 
                            : customPlan.discounts[`year${years}`][discountKey];
                    }
                    
                    renewalSectionHtml = `
                        <div class="print-data-table">
                            <h2>Renewal Pricing (${renewalYears} Years)</h2>
                            <table class="print-table">
                                <tr>
                                    <td class="label">Base Rate Per User/Year</td>
                                    <td class="value">${formatCurrency(basePricePerUser)}</td>
                                </tr>
                                <tr>
                                    <td class="label">Total Base Price (${users} Users, ${renewalYears} Years)</td>
                                    <td class="value">${formatCurrency(basePricePerUser * users * renewalYears)}</td>
                                </tr>
                                 <tr>
                                    <td class="label">Renewal Discount (${(renewalDiscountRate * 100).toFixed(2)}%)</td>
                                    <td class="value">${formatCurrency(basePricePerUser * users * renewalYears * renewalDiscountRate)}</td>
                                </tr>
                                <tr>
                                    <td class="label">Taxable Amount</td>
                                    <td class="value">${formatCurrency(contractRenewalPriceUntaxed)}</td>
                                </tr>
                                <tr>
                                    <td class="label">GST (${(GST_RATE * 100).toFixed(0)}%)</td>
                                    <td class="value">${formatCurrency(contractRenewalPrice - contractRenewalPriceUntaxed)}</td>
                                </tr>
                                <tr class="total-row">
                                    <td class="label">Total Renewal Cost (inc. GST)</td>
                                    <td class="value">${formatCurrency(contractRenewalPrice)}</td>
                                </tr>
                            </table>
                        </div>
                    `;
                }
                
                const contractPriceFinal = data[`price${years}Y_final`];
                const nonContractPriceFinal = data[`nonContract${years}Y_final`];
                const contractPriceUntaxed = contractPriceFinal / (1 + GST_RATE);
                const nonContractPriceUntaxed = nonContractPriceFinal / (1 + GST_RATE);
                
                const totalSavings = data[`savings${years}Y`] || 0;
                const totalSavingsPercent = data[`savingsPercent${years}Y`] || 0;
                
                // Calculate Average Cost Per User Per Year (Untaxed)
                const avgContractCostPerUserPerYear = contractPriceUntaxed / users / years;
                const avgNonContractCostPerUserPerYear = nonContractPriceUntaxed / users / years;


                const reportHtml = `
                    <div class="print-report">
                        <!-- Added Odoo Logo here -->
                        <div class="print-logo-container">
                            <img src="https://odoocdn.com/openerp_website/static/src/img/assets/svg/odoo_logo.svg" alt="Odoo Logo">
                        </div>
                        <div class="print-header">
                            <div class="print-title">
                                <h1>Odoo Pricing Analysis</h1>
                                <p>${durationName} Odoo ${planName} Plan | Cost Analysis for ${users} Users</p>
                            </div>
                        </div>
                        
                        <div class="print-body">
                            <!-- FIRST YEAR PRICING -->
                            <div class="print-data-table">
                                <h2>First-Year Pricing (on First Order only)</h2>
                                <table class="print-table">
                                    <tr>
                                        <td class="label">Base Rate Per User/Year</td>
                                        <td class="value">${formatCurrency(basePricePerUser)}</td>
                                    </tr>
                                    <tr>
                                        <td class="label">Total Base Price (${users} Users)</td>
                                        <td class="value">${formatCurrency(basePricePerUser * users)}</td>
                                    </tr>
                                     <tr>
                                        <td class="label">Discount (${year1DiscountPercentage.toFixed(2)}%)</td>
                                        <td class="value">-${formatCurrency(year1DiscountAmount)}</td>
                                    </tr>
                                    <tr>
                                        <td class="label">Taxable Amount</td>
                                        <td class="value">${formatCurrency(firstYearTaxable)}</td>
                                    </tr>
                                    <tr>
                                        <td class="label">GST (${(GST_RATE * 100).toFixed(0)}%)</td>
                                        <td class="value">${formatCurrency(firstYearGST)}</td>
                                    </tr>
                                    <tr class="total-row">
                                        <td class="label">Total First-Year Cost (inc. GST)</td>
                                        <td class="value">${formatCurrency(firstYearTotal)}</td>
                                    </tr>
                                </table>
                            </div>

                            <!-- RENEWAL PRICING (only shows for > 1 year) -->
                            ${renewalSectionHtml}

                            <!-- NON-CONTRACT AND SAVINGS SUMMARY (always present, but placement might change if renewal is present) -->
                            <div class="print-data-table" style="grid-column: ${renewalYears === 0 ? '2' : '1 / -1'};">
                                <h2>Non-Contract & Savings Summary (${years} Years)</h2>
                                <table class="print-table">
                                    <tr>
                                        <td class="label font-bold">Total Contract Price (inc. GST)</td>
                                        <td class="value font-bold">${formatCurrency(contractPriceFinal)}</td>
                                    </tr>
                                    <tr>
                                        <td class="label">Avg. Contract Cost / User / Year (Untaxed)</td>
                                        <td class="value">${formatCurrency(avgContractCostPerUserPerYear)}</td>
                                    </tr>
                                    <tr>
                                        <td class="label">Total Non-Contract Price (inc. GST)</td>
                                        <td class="value">${formatCurrency(nonContractPriceFinal)}</td>
                                    </tr>
                                    <tr>
                                        <td class="label">Avg. Non-Contract Cost / User / Year (Untaxed)</td>
                                        <td class="value">${formatCurrency(avgNonContractCostPerUserPerYear)}</td>
                                    </tr>
                                    <tr class="savings-row">
                                        <td class="label font-bold">Total Contract Savings vs. Non-Contract</td>
                                        <td class="value">${formatCurrency(totalSavings)} (${totalSavingsPercent.toFixed(2)}%)</td>
                                    </tr>
                                </table>
                            </div>
                        </div>

                        <!-- FOOTER SECTION -->
                        <div class="print-footer">
                            <p>This proposal is related to the "Odoo Enterprise Subscription Agreement" available on <a href="https://www.odoo.com/r/enterprise-contract">https://www.odoo.com/r/enterprise-contract</a></p>
                            <p>Note: Minor customizations are done through Odoo Studio, included in the custom plan. But major developments, like Python modules, might require an Odoo.sh cloud subscription. For more information, connect with your Account Manager.</p>
                        </div>
                    </div>
                `;

                printReportContainer.innerHTML = reportHtml;
                window.print();
            };

            usersInput.addEventListener('input', () => {
                const users = parseInt(usersInput.value);
                usersNumberInput.value = users;
                updateUI();
            });
            usersNumberInput.addEventListener('input', () => {
                let users = parseInt(usersNumberInput.value);
                if (isNaN(users) || users < 1) { users = 1; }
                if (users > 100) { users = 100; }
                usersInput.value = users;
                updateUI();
            });

            standardTabBtn.addEventListener('click', () => {
                standardTabBtn.classList.add('active');
                customTabBtn.classList.remove('active');
                currentPlan = 'standard';
                updateUI();
            });
            customTabBtn.addEventListener('click', () => {
                customTabBtn.classList.add('active');
                standardTabBtn.classList.remove('active');
                currentPlan = 'custom';
                updateUI();
            });

            contractButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    contractButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentContract = btn.id.replace('-btn', '');
                    updateUI();
                });
            });

            printBtn.addEventListener('click', () => {
                generatePrintReport(currentPlan, currentContract, parseInt(usersInput.value));
            });
             window.addEventListener('afterprint', () => {
                printReportContainer.innerHTML = '';
            });

            updateUI();
        });
    </script>
</body>
</html>
